name: Generate Keystore

on:
  workflow_dispatch:

jobs:
  generate-keystore:
    runs-on: ubuntu-latest
    steps:
      - name: Generate Keystore
        run: |
          # Generate variables
          ALIAS="varisankya-alias"
          PASSWORD=$(openssl rand -base64 12)
          KEY_PASSWORD=$(openssl rand -base64 12)
          
          # Generate Keystore
          keytool -genkey -v -keystore release.keystore \
            -alias $ALIAS \
            -keyalg RSA \
            -keysize 2048 \
            -validity 10000 \
            -storepass $PASSWORD \
            -keypass $KEY_PASSWORD \
            -dname "CN=Varisankya, OU=App, O=Varisankya, L=Unknown, ST=Unknown, C=US"

          # Encode to Base64
          BASE64_KEYSTORE=$(base64 -w 0 release.keystore)

          # Output Secrets
          echo "::notice title=ANDROID_KEYSTORE_BASE64::$BASE64_KEYSTORE"
          echo "::notice title=KEYSTORE_PASSWORD::$PASSWORD"
          echo "::notice title=KEY_ALIAS::$ALIAS"
          echo "::notice title=KEY_PASSWORD::$KEY_PASSWORD"
          
          echo "========================================================"
          echo "SAVE THESE SECRETS TO YOUR GITHUB REPOSITORY SETTINGS:"
          echo "========================================================"
          echo "ANDROID_KEYSTORE_BASE64: (See Notice or below)"
          echo "$BASE64_KEYSTORE"
          echo ""
          echo "KEYSTORE_PASSWORD: $PASSWORD"
          echo "KEY_ALIAS: $ALIAS"
          echo "KEY_PASSWORD: $KEY_PASSWORD"
          echo "========================================================"
